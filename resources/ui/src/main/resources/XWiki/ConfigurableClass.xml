<?xml version="1.0" encoding="UTF-8"?>

<!--
 * See the NOTICE file distributed with this work for additional
 * information regarding copyright ownership.
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with this program.  If not, see http://www.gnu.org/licenses/
-->

<xwikidoc version="1.1">
  <web>XWiki</web>
  <name>ConfigurableClass</name>
  <language/>
  <defaultLanguage/>
  <translation>0</translation>
  <creator>xwiki:XWiki.Admin</creator>
  <parent>XWiki.WebHome</parent>
  <author>xwiki:XWiki.Admin</author>
  <contentAuthor>xwiki:XWiki.Admin</contentAuthor>
  <version>1.1</version>
  <title>$services.localization.render('xe.admin.configurable.title')</title>
  <comment/>
  <minorEdit>false</minorEdit>
  <syntaxId>xwiki/2.0</syntaxId>
  <hidden>true</hidden>
  <content>{{include reference="XWiki.ConfigurableClassMacros" /}}

{{velocity}}
#*
 * This part takes the configuration from any documents containing XWiki.ConfigurableClass objects and creates a form
 * for each. To includeForm this document, you may specify:
 *
 * $section - String - The section which we are administrating eg: "Registration", "Users", or "Import".
 *                     If none is specified then it checks for a request parameter called "section" and uses that,
 *                     if no parameter, then this code assumes that it is part of the admin icons sheet and adds icons
 *                     for any section which is not in $sections, in that event, this code assumes it is being run
 *                     inside of a &lt;ul&gt; block.
 *
 * $sections - List&lt;String&gt; - If section is not specified, any sections on this list will not have icons made for them,
 *                            the assumption being that the icons are already there. If section is specified then this
 *                            is not taken into account and may safely be undefined.
 *
 * $currentDoc - String (document.fullName) - The administration document, users who don't have permission to edit
 *                                            it will not be able to include applications (possibly injecting
 *                                            arbitrary code.) if none specified then $doc.getFullName() is used.
 *
 * $globaladmin - boolean - If set true then we will assume we are administrationg the entire wiki.
 *                          If not set then we look for a request parameter called "editor" if that exists and equals
 *                          "globaladmin" then $globaladmin is true, if it doesn't exist then we check to see if
 *                          $currentDoc.getFullName() equals "XWiki.XWikiPreferences".
 *###
##
## Form submission depends on this.
$xwiki.jsfx.use('js/xwiki/actionbuttons/actionButtons.js', true)
##
#if(!$section)
  #set($section = $request.getParameter('section'))
#end
#if(!$currentDoc)
  #set($currentDoc = $doc.getFullName())
#end
## Get value of $globaladmin if not specified.
#if("$!globaladmin" == '')
  #if($editor != 'globaladmin'
      &amp;&amp; $request.getParameter('editor') != 'globaladmin'
      &amp;&amp; $currentDoc != 'XWiki.XWikiPreferences')
  ##
    #set($globaladmin = false)
  #else
    #set($globaladmin = true)
  #end
#end
#set($currentSpace = $xwiki.getDocument($currentDoc).getSpace())
##
## This application should not run with programming rights because it evaluates code which may not be trustworthy.
## Removing the next line will open a security hole.
$doc.dropPermissions()##
##
##------------------------------------------------------------------------------------------------------------
## If $section exists then we are viewing the admin page for a particular section.
## eg: 'Registration', 'Presentation', 'Import' etc.
##------------------------------------------------------------------------------------------------------------
##
#if($section &amp;&amp; $section != '')
  ##
  ## This is for keeping track of whether we have shown the heading yet or not.
  ## If the heading doesn't need to be shown, but an error occurs in processing, then we show the heading
  ## so that the user knows what the error relates to.
  #set($headingShowing = false)
  ##
  ## Searches the database for names of apps to be configured
  #set($outputList = [])
  #findNamesOfAppsToConfigure($section, $globaladmin, $xwiki.getDocument($currentDoc).getSpace(), $outputList)
  ##
  #foreach($appName in $outputList)
    ##
    ## Make sure the current user has permission to edit the configurable application.
    #set($userHasAccessToDocument = $xcontext.hasAccessLevel('edit', $appName))
    ##
    ## If the document was not last saved by a user with edit privilege on this page
    ## then we can't safely display the page but we should warn the viewer.
    #if($userHasAccessToDocument)
      ## Get the configurable application
      #set($app = $xwiki.getDocument($appName))
      ##
      #set($documentSavedByAuthorizedUser = false)
      #checkDocumentSavedByAuthorizedUser($app, $currentDoc, $documentSavedByAuthorizedUser)
    #end
    ##
    ## There is no need to display a heading unless:
    ## 1. There was already a section before this document.
    ## 2. This is not the first document in this section.
    ##
    ## If we are displaying the heading and there is an error to be shown Javascript will not strip the heading.
    #if(!$appName.equals($outputList.get(0)) || $sections.contains($section))
      ## Create a document heading.
      #showHeading($appName, $headingShowing)
    #end
    ##
    #if(!$userHasAccessToDocument)
      #showHeading($appName, $headingShowing)

      {{error}}{{translation key="xe.admin.configurable.noPermissionThisApplication"/}}{{/error}}

    #elseif(!$documentSavedByAuthorizedUser)
      #showHeading($appName, $headingShowing)

      {{error}}{{translation key="xe.admin.configurable.applicationAuthorNoAdmin" parameters="$app.Author"/}}{{/error}}

    ##
    ##------------------------------------------------------------------------------------------------------------
    ## If the document is locked and not by the current user and forceEdit is not set true,
    #elseif($app.getLocked() &amp;&amp; $app.getLockingUser() != $xcontext.getUser() &amp;&amp; !$request.getParameter('forceEdit'))
      #set($requestURL = "$request.getRequestURL()")
      #if($requestURL.indexOf('?') == -1)
        #set($requestURL = "${requestURL}?")
      #end
      #showHeading($appName, $headingShowing)

      {{error}}{{translation key="doclockedby"/}} $app.getLockingUser() [[{{translation key="forcelock"/}}&gt;&gt;${requestURL}&amp;forceEdit=1]]{{/error}}

    #else
      ## If the document is not already locked, attempt to acquire the lock.
      #if(!$app.getLocked())

        {{html wiki=true}}
          &lt;noscript&gt;

            {{warning}}{{translation key="xe.admin.configurable.cannotLockNoJavascript"/}}{{/warning}}

          &lt;/noscript&gt;
          &lt;script type="text/javascript"&gt;
            document.observe("xwiki:dom:loaded", function() {
              XWiki.DocumentLock &amp;&amp; new XWiki.DocumentLock('$escapetool.javascript($app.fullName)').lock();
            });
          &lt;/script&gt;
        {{/html}}
      #end
      ##------------------------------------------------------------------------------------------------------------
      ## Done Locking.
      ##
      ## Get all objects of the "ConfigurableClass" from this document.
      #set($allConfigurableObjs = $app.getObjects($nameOfThisDocument))
      ## Separate out the objects which are for this section.
      #set($configurableObjs = [])
      #foreach($configurableObj in $allConfigurableObjs)
        #if($app.getValue('displayInSection', $configurableObj) == $section)
          ## If this is space admin, then don't display global, if global don't display space.
          #if($globaladmin == ($app.getValue('configureGlobally', $configurableObj) == 1))
            #set($discard = $configurableObjs.add($configurableObj))
          #end
        #end
      #end
      #if($configurableObjs.size() == 0)
        ## Internal error, not translated.
        #showHeading($appName, $headingShowing)

        {{error}}Internal error: All objects were filtered out for application: $appName.{{/error}}

      #else
        #set($formAction = $xwiki.getURL($app.getFullName(), 'save'))
        #set($formId = "${section.toLowerCase()}_${app.getFullName()}")
        #set($escapedAppName = $escapetool.xml($app.getFullName()))
        #foreach($configurableObj in $configurableObjs)
          ## Display the header if one exists.
          #set($heading = $app.getValue('heading', $configurableObj))
          #if($heading &amp;&amp; $heading != '')
            == #evaluate($heading) ==
          #end
          ##
          #set($codeToExecute = "$!app.getValue('codeToExecute', $configurableObj)")
          #if($codeToExecute != '')
            (%class="codeToExecute"%)(((##
              #evaluate($codeToExecute)##
            )))
          #end
          ##
          ## If propertiesToShow is set, then we will only show the properties contained therein.
          #set($propertiesToShow = $app.getValue('propertiesToShow', $configurableObj))
          #if(!$propertiesToShow || $propertiesToShow.getClass().getName().indexOf('List') == -1)
            #set($propertiesToShow = [])
          #end
          ##
          ## If linkPrefix is set, then we will make each property label a link which starts with that prefix.
          #set($linkPrefix = "$!app.getValue('linkPrefix', $configurableObj)")
          ##
          ## If the Configurable object specifies a configuration class, use it,
          ## otherwise assume custom forms are used instead.
          #set($configClassName = "$!app.getValue('configurationClass', $configurableObj)")
          #if($configClassName != '')
            #set($objClass = $xwiki.getDocument($configClassName).getxWikiClass())
            #if(!$objClass || $objClass.getClass().getName().indexOf('.Class') == -1)
              #showHeading($appName, $headingShowing)

              {{error}}{{translation key="xe.admin.configurable.configurationClassNonexistant"/}}{{/error}}

            #else
              ## Use the first object from the document which is of the configuration class.
              #set($obj = $app.getObject($objClass.getName()))
              ##
              #if(!$obj || $obj.getClass().getName().indexOf('.Object') == -1)
                #showHeading($appName, $headingShowing)

                {{error}}
                  {{translation key="xe.admin.configurable.noObjectOfConfigurationClassFound" parameters="$objClass.getName(), $app.getFullName()"/}}
                {{/error}}

              #else
                ##
                ## Merge save buttons, remove headings from subsections, and make information links into popups.
                ## This is not done if there is only a custom defined form.
                $xwiki.jsx.use($nameOfThisDocument)##
                ##
                ## We don't begin the form until we have content for it so that a configurable can specify a
                ## custom form in codeToExecute and if that configurable object is the first of it's kind in that
                ## document, the custom form will not be put inside of our form.
                #if(!$insideForm)
                  ## We are opening a form and fieldset without closing it, thus we cannot clean this html.

                  {{html clean=false}}
                    &lt;form id="$formId" method="post" action="$formAction" class="xform half"&gt;
                      &lt;fieldset&gt;
                  {{/html}}
                  #set($insideForm = true)
                #end

                {{html}}
                  $formHtml.toString()
                {{/html}}
              #end## If object exists
            #end## If class exists
          #end## If class name is specified.
        #end## Foreach configurable object found in this document
        ## If a form was started then we end it.
        #if($insideForm)

          ## This is closing an open form which was opened above, we cannot clean this html.
          {{html clean=false}}
          ## We add in a redirect field to prevent the user from being carried away when they save
          ## if they don't have javascript.
          #set($thisURL = $request.getRequestURL())
          #if($request.getQueryString() &amp;&amp; $request.getQueryString().length() &gt; 0)
            #set($thisURL = "${thisURL}?$request.getQueryString()")
          #end
          &lt;input type="hidden" id="${escapedAppName}_redirect" name="$redirectParameter" value="$escapetool.xml($thisURL)" /&gt;
          &lt;input type="hidden" name="form_token" value="$!{services.csrf.getToken()}" /&gt;
          &lt;/fieldset&gt;
          &lt;div class="bottombuttons"&gt;
            &lt;p class="admin-buttons"&gt;
              &lt;span class="buttonwrapper"&gt;
                ## Text to display on the button. If there is a heading then this button should be labeled
                ## that it is for saving this section. Otherwise it should be a generic "save" button.
                #if($headingShowing)
                  #set($buttonText = "$services.localization.render('admin.save') $escapedAppName")
                #else
                  #set($buttonText = "$services.localization.render('admin.save')")
                #end
                &lt;input class="button" type="submit" name="action_saveandcontinue" value="$buttonText" /&gt;
              &lt;/span&gt;
            &lt;/p&gt;
          &lt;/div&gt; ## bottombuttons
          &lt;/form&gt;
          #set($insideForm = false)
          {{/html}}
        #end
      #end## If there are configurable objects
    #end## If document is not locked or forceEdit is enabled
  #end## Foreach document name in names to configure

  {{html}}
  &lt;script type="text/javascript"&gt;
  /* &lt;![CDATA[ */
  ## Alt+Shift+S presses the first saveAndContinue button it finds, not what we want so we will disable edit shortcuts.
  document.observe('xwiki:dom:loaded', function() {
    XWiki.actionButtons.EditActions = Object.extend(XWiki.actionButtons.EditActions, {addShortcuts : function() { }});
  });
  //]]&gt;
  &lt;/script&gt;
  {{/html}}##
  ##
#else
  ##
  ##------------------------------------------------------------------------------------------------------------
  ## If section is not set then we are viewing the main administration page.
  ##------------------------------------------------------------------------------------------------------------
  ##
  ## If there is no list called sections then we set sections to an empty list.
  #if(!$sections || $sections.getClass().getName().indexOf('List') == -1)
    #set($sections = [])
  #end
  ##
  ## We have to create a list of documents which the current user doesn't have permission to view.
  ## So we can add an error message to the bottom of the page if there are any.
  #set($appsUserCannotView = [])
  ##
  ## A list of sections (to be added) which the user is not allowed to edit, icons will be displayed with a message
  #set($sectionsUserCannotEdit = [])
  ## List of sections to be added, in order by creationDate of oldest contained application.
  #set($sectionsToAdd = [])
  ## Map of URL of icon to use by the name of the section to use that icon on.
  #set($iconBySection = {})
  ##
  #set($outputList = [])
  #findNamesOfAppsToConfigure("", $globaladmin, $currentSpace, $outputList)
  ##
  #foreach($appName in $outputList)
    ##
    ## Get the configurable application
    #set($app = $xwiki.getDocument($appName))
    ##
    ## If getDocument returns null, then warn the user that they don't have view access to that application.
    #if(!$app)
      #set($discard = $appsUserCannotView.add($appName))
    #end
    ##
    #set($configurableObjects = $app.getObjects($nameOfThisDocument))
    #foreach($configurableObject in $configurableObjects)
      #set($displayInSection = $app.getValue('displayInSection', $configurableObject))
      ##
      ## If there is no section for this configurable or if the section cannot be edited, then check if the
      ## application can be edited by the current user, if so then we display the icon from the current app and
      ## don't display any message to tell the user they can't edit that section.
      #if(!$sections.contains($displayInSection) || $sectionsUserCannotEdit.contains($displayInSection))
        ##
        ## If there is no section for this configurable, then we will have to add one.
        #if(!$sections.contains($displayInSection) &amp;&amp; !$sectionsToAdd.contains($displayInSection))
          #set($discard = $sectionsToAdd.add($displayInSection))
        #end
        ##
        ## If an attachment by the filename iconAttachment exists and is an image
        #set($attachment = $app.getAttachment("$app.getValue('iconAttachment', $configurableObject)"))
        #if($attachment &amp;&amp; $attachment.isImage())
          ## Set the icon for this section as the attachment URL.
          #set($discard = $iconBySection.put($displayInSection, $app.getAttachmentURL($attachment.getFilename())))
        #end
        ##
        ## If the user doesn't have edit access to the application, we want to show a message on the icon
        #if(!$xcontext.hasAccessLevel("edit", $app.getFullName()))
          #if(!$sectionsUserCannotEdit.contains($displayInSection))
            #set($discard = $sectionsUserCannotEdit.add($displayInSection))
          #end
        #elseif($sectionsUserCannotEdit.contains($displayInSection))
          ## If the user didn't have access to the section before but does have access to _this_ app which is
          ## configured in the section, then the section becomes accessible.
          #set($discard = $sectionsUserCannotEdit.remove($displayInSection))
        #end
      #end## If section doesn't exist or user doesn't have access.
    #end## Foreach configurable object in this app.
  #end## Foreach application which is configurable.
  ##
  ## Now we go through sectionsToAdd and generate icons for them
  #set($defaultIcon = $xwiki.getAttachmentURL($nameOfThisDocument, 'DefaultAdminSectionIcon.png'))
  #if($globaladmin)
    #set($queryString = "editor=globaladmin&amp;amp;section=")
  #else
    #set($queryString = "space=${currentSpace}&amp;amp;section=")
    #if($request.getParameter('editor'))
      #set($queryString = "editor=$escapetool.url($request.getParameter('editor'))&amp;amp;$queryString")
    #end
  #end

  ## This is an html fragment and thus cannot be cleaned
  {{html clean=false}}
  #foreach($sectionToAdd in $sectionsToAdd)
    #set($icon = $iconBySection.get($sectionToAdd))
    #if(!$icon)
      #set($icon = $defaultIcon)
    #end
    &lt;li class="$escapetool.xml($sectionToAdd).replaceAll(' ', '_')"&gt;
      #set($hasAccess = !$sectionsUserCannotEdit.contains($sectionToAdd))
      #if($hasAccess)
        &lt;a href="$xwiki.getURL($currentDoc, $xcontext.getAction(), "$queryString$escapetool.url($sectionToAdd)")"&gt;
      #else
        &lt;a title="$services.localization.render('xe.admin.configurable.sectionIconNoAccessTooltip')"&gt;
      #end
      &lt;span&gt;
      &lt;img src="$icon" alt="$escapetool.xml($sectionToAdd) icon"/&gt;
      ## Try to translate the names of the sections, build the key by adding an "admin." in front.
      ## Not the best way to translate, but very inline with the way the translations are done in XWiki.AdminSheet for individual administration page titles.
      ## If there is no translation (translated message is equals to key), don't display the message key, but the section name instead.
      #if($services.localization.get("admin.${sectionToAdd.toLowerCase()}"))
        #set($sectionDisplayName = $services.localization.render("admin.${sectionToAdd.toLowerCase()}"))
      #else
        #set($sectionDisplayName = $sectionToAdd)
      #end
      $escapetool.xml($sectionDisplayName)
      &lt;/span&gt;
      #if(!$hasAccess)
        &lt;br/&gt;&lt;span class="errormessage"&gt;$services.localization.render('xe.admin.configurable.sectionIconNoAccess')&lt;/span&gt;
      #end
      &lt;/a&gt;
    &lt;/li&gt;
  #end
  {{/html}}

  ## Finally we display an error message if there are any applications which we were unable to view.
  #if($appsUserCannotView.size() &gt; 0)

    {{error}}$services.localization.render('xe.admin.configurable.noViewAccessSomeApplications', [$appsUserCannotView]){{/error}}

  #end
#end## If we should be looking at the main administration page.
{{/velocity}}</content>
  <attachment>
    <filename>DefaultAdminSectionIcon.png</filename>
    <mimetype>image/png</mimetype>
    <author>xwiki:XWiki.Admin</author>
    <version>1.1</version>
    <comment/>
    <content>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</content>
    <filesize>4198</filesize>
  </attachment>
  <class>
    <name>XWiki.ConfigurableClass</name>
    <customClass/>
    <customMapping/>
    <defaultViewSheet/>
    <defaultEditSheet/>
    <defaultWeb/>
    <nameField/>
    <validationScript/>
    <advancedOnly>
      <customDisplay/>
      <defaultValue/>
      <disabled>0</disabled>
      <displayFormType>select</displayFormType>
      <displayType/>
      <name>advancedOnly</name>
      <number>5</number>
      <prettyName>advancedOnly</prettyName>
      <unmodifiable>0</unmodifiable>
      <validationMessage/>
      <validationRegExp/>
      <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
    </advancedOnly>
    <categoryIcon>
      <customDisplay/>
      <disabled>0</disabled>
      <name>categoryIcon</name>
      <number>11</number>
      <picker>0</picker>
      <prettyName>categoryIcon</prettyName>
      <size>30</size>
      <unmodifiable>0</unmodifiable>
      <validationMessage/>
      <validationRegExp/>
      <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
    </categoryIcon>
    <categoryPriority>
      <customDisplay/>
      <disabled>0</disabled>
      <name>categoryPriority</name>
      <number>2</number>
      <numberType>integer</numberType>
      <prettyName>categoryPriority</prettyName>
      <size>30</size>
      <unmodifiable>0</unmodifiable>
      <validationMessage/>
      <validationRegExp/>
      <classType>com.xpn.xwiki.objects.classes.NumberClass</classType>
    </categoryPriority>
    <codeToExecute>
      <customDisplay/>
      <disabled>0</disabled>
      <editor>---</editor>
      <name>codeToExecute</name>
      <number>11</number>
      <picker>0</picker>
      <prettyName>codeToExecute</prettyName>
      <rows>5</rows>
      <size>40</size>
      <unmodifiable>0</unmodifiable>
      <validationMessage/>
      <validationRegExp/>
      <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
    </codeToExecute>
    <configurationClass>
      <customDisplay/>
      <disabled>0</disabled>
      <name>configurationClass</name>
      <number>7</number>
      <picker>0</picker>
      <prettyName>configurationClass</prettyName>
      <size>30</size>
      <unmodifiable>0</unmodifiable>
      <validationMessage/>
      <validationRegExp/>
      <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
    </configurationClass>
    <configureGlobally>
      <customDisplay/>
      <defaultValue/>
      <disabled>0</disabled>
      <displayFormType>checkbox</displayFormType>
      <displayType/>
      <name>configureGlobally</name>
      <number>8</number>
      <prettyName>configureGlobally</prettyName>
      <unmodifiable>0</unmodifiable>
      <validationMessage/>
      <validationRegExp/>
      <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
    </configureGlobally>
    <displayBeforeCategory>
      <customDisplay/>
      <disabled>0</disabled>
      <name>displayBeforeCategory</name>
      <number>10</number>
      <picker>0</picker>
      <prettyName>displayBeforeCategory</prettyName>
      <size>30</size>
      <unmodifiable>0</unmodifiable>
      <validationMessage/>
      <validationRegExp/>
      <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
    </displayBeforeCategory>
    <displayInCategory>
      <customDisplay/>
      <disabled>0</disabled>
      <name>displayInCategory</name>
      <number>1</number>
      <picker>0</picker>
      <prettyName>displayInCategory</prettyName>
      <size>30</size>
      <unmodifiable>0</unmodifiable>
      <validationMessage/>
      <validationRegExp/>
      <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
    </displayInCategory>
    <displayInSection>
      <customDisplay/>
      <disabled>0</disabled>
      <name>displayInSection</name>
      <number>3</number>
      <picker>0</picker>
      <prettyName>displayInSection</prettyName>
      <size>30</size>
      <unmodifiable>0</unmodifiable>
      <validationMessage/>
      <validationRegExp/>
      <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
    </displayInSection>
    <heading>
      <customDisplay/>
      <disabled>0</disabled>
      <name>heading</name>
      <number>6</number>
      <picker>0</picker>
      <prettyName>heading</prettyName>
      <size>30</size>
      <unmodifiable>0</unmodifiable>
      <validationMessage/>
      <validationRegExp/>
      <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
    </heading>
    <iconAttachment>
      <customDisplay/>
      <disabled>0</disabled>
      <name>iconAttachment</name>
      <number>12</number>
      <picker>0</picker>
      <prettyName>iconAttachment</prettyName>
      <size>30</size>
      <unmodifiable>0</unmodifiable>
      <validationMessage/>
      <validationRegExp/>
      <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
    </iconAttachment>
    <linkPrefix>
      <customDisplay/>
      <disabled>0</disabled>
      <name>linkPrefix</name>
      <number>9</number>
      <picker>0</picker>
      <prettyName>linkPrefix</prettyName>
      <size>30</size>
      <unmodifiable>0</unmodifiable>
      <validationMessage/>
      <validationRegExp/>
      <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
    </linkPrefix>
    <propertiesToShow>
      <cache>0</cache>
      <customDisplay/>
      <disabled>0</disabled>
      <displayType>input</displayType>
      <multiSelect>1</multiSelect>
      <name>propertiesToShow</name>
      <number>10</number>
      <picker>0</picker>
      <prettyName>propertiesToShow</prettyName>
      <relationalStorage>1</relationalStorage>
      <separator> </separator>
      <separators> ,|</separators>
      <size>20</size>
      <sort>none</sort>
      <unmodifiable>0</unmodifiable>
      <validationMessage/>
      <validationRegExp/>
      <values/>
      <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
    </propertiesToShow>
    <sectionOrder>
      <customDisplay/>
      <disabled>0</disabled>
      <name>sectionOrder</name>
      <number>12</number>
      <numberType>integer</numberType>
      <prettyName>sectionOrder</prettyName>
      <size>30</size>
      <unmodifiable>0</unmodifiable>
      <validationMessage/>
      <validationRegExp/>
      <classType>com.xpn.xwiki.objects.classes.NumberClass</classType>
    </sectionOrder>
    <sectionPriority>
      <customDisplay/>
      <disabled>0</disabled>
      <name>sectionPriority</name>
      <number>4</number>
      <numberType>integer</numberType>
      <prettyName>sectionPriority</prettyName>
      <size>30</size>
      <unmodifiable>0</unmodifiable>
      <validationMessage/>
      <validationRegExp/>
      <classType>com.xpn.xwiki.objects.classes.NumberClass</classType>
    </sectionPriority>
  </class>
  <object>
    <name>XWiki.ConfigurableClass</name>
    <number>0</number>
    <className>XWiki.JavaScriptExtension</className>
    <guid>71fc6ffa-92cb-48f1-9d80-a845d1807b10</guid>
    <class>
      <name>XWiki.JavaScriptExtension</name>
      <customClass/>
      <customMapping/>
      <defaultViewSheet/>
      <defaultEditSheet/>
      <defaultWeb/>
      <nameField/>
      <validationScript/>
      <cache>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>select</displayType>
        <multiSelect>0</multiSelect>
        <name>cache</name>
        <number>5</number>
        <prettyName>Caching policy</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator> </separator>
        <separators>|, </separators>
        <size>1</size>
        <unmodifiable>0</unmodifiable>
        <values>long|short|default|forbid</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </cache>
      <code>
        <disabled>0</disabled>
        <name>code</name>
        <number>2</number>
        <prettyName>Code</prettyName>
        <rows>20</rows>
        <size>50</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
      </code>
      <name>
        <disabled>0</disabled>
        <name>name</name>
        <number>1</number>
        <prettyName>Name</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </name>
      <parse>
        <disabled>0</disabled>
        <displayFormType>select</displayFormType>
        <displayType>yesno</displayType>
        <name>parse</name>
        <number>4</number>
        <prettyName>Parse content</prettyName>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
      </parse>
      <use>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>select</displayType>
        <multiSelect>0</multiSelect>
        <name>use</name>
        <number>3</number>
        <prettyName>Use this extension</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator> </separator>
        <separators>|, </separators>
        <size>1</size>
        <unmodifiable>0</unmodifiable>
        <values>currentPage|onDemand|always</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </use>
    </class>
    <property>
      <cache>long</cache>
    </property>
    <property>
      <code>document.observe('xwiki:dom:loaded', function() {
  // Hide headers unless they have error messages under them.
  var elementsInPage = $('admin-page-content').childNodes;
  var errorShown = false;
  for (var i = elementsInPage.length - 1; i &gt; -1; i--) {
    var e = elementsInPage[i];
    if (e.tagName != undefined &amp;&amp; e.tagName.toLowerCase() == 'div' &amp;&amp; e.getAttribute('class') != undefined &amp;&amp; e.getAttribute('class').indexOf('errormessage') != -1)
    {
      errorShown = true;
    } else if (!errorShown
               &amp;&amp; e.tagName != undefined
               &amp;&amp; e.tagName.toLowerCase() == 'h1'
               &amp;&amp; e.getAttribute('id') != undefined
               &amp;&amp; e.getAttribute('id').toLowerCase().indexOf('hcustomize') == 0)
    {
      e.parentNode.removeChild(e);
      errorShown = false;
    }
  }

  // Hide individual submit buttons.
  var forms = $('admin-page-content').select('form');
  var inputs = $('admin-page-content').select('input');
  for (var i = 0; i &lt; inputs.length; i++) {
    if (inputs[i].getAttribute('type') != undefined &amp;&amp; inputs[i].getAttribute('type').toLowerCase() == 'submit') {
      var bottombuttons = inputs[i].up('.bottombuttons');
      bottombuttons &amp;&amp; bottombuttons.remove();
    }
  }

  // Add a submit button for saving all sections at once.
  var button = new Element('input', {'type':'submit', 'class':'button', 'value':'$services.localization.render("admin.save")', 'name':'formactionsac'});
  var wrapper = new Element('span', {'class':'buttonwrapper'});
  var adminButtons = new Element('p', {'class':'admin-buttons'});
  var bottomButtons = new Element('div', {'class':'bottombuttons'});
  $('admin-page-content').appendChild(bottomButtons);
  bottomButtons.appendChild(adminButtons);
  adminButtons.appendChild(wrapper);
  wrapper.appendChild(button);

  Event.observe(button, 'click', function() {
    var forms = $('admin-page-content').getElementsByTagName('form');
    for (var i = 0; i &lt; forms.length; i++) {
      Event.fire(document, 'xwiki:actions:save', {'form':forms[i].id, 'continue':true});
    }
  });
});</code>
    </property>
    <property>
      <name/>
    </property>
    <property>
      <parse>1</parse>
    </property>
    <property>
      <use>onDemand</use>
    </property>
  </object>
</xwikidoc>
